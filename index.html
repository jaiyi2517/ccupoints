<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>記分白板</title>
    
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 載入 React 與 React DOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 載入 Babel 用於解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 載入 Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Covered+By+Your+Grace&family=Knewave&family=Noto+Sans+TC:wght@400;700;900&family=Noto+Serif+TC:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        /* 基礎樣式重置 */
        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // 模擬 Lucide React 圖示組件 (SVG)
        const Eraser = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"/><path d="M22 21H7"/><path d="m5 11 9 9"/></svg>
        );
        const X = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        );
        const Check = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 6 9 17l-5-5"/></svg>
        );
        const Trash2 = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
        );

        // 自定義字體樣式與動畫 CSS
        const FontStyles = () => (
            <style>{`
                /* 字體策略 */
                .font-marker { 
                font-family: 'Knewave', 'Noto Sans TC', sans-serif; 
                }
                .font-hand { 
                font-family: 'Covered By Your Grace', 'Noto Serif TC', cursive; 
                }
                .font-tw-bold {
                font-family: 'Noto Sans TC', sans-serif;
                font-weight: 700;
                }
                .font-tw-serif-bold {
                font-family: 'Noto Serif TC', serif;
                font-weight: 700;
                }

                /* 白板背景紋理 */
                .whiteboard-bg {
                background-color: #f8f9fa;
                background-image: 
                    linear-gradient(rgba(0, 0, 0, 0.05) 1px, transparent 1px),
                    linear-gradient(90deg, rgba(0, 0, 0, 0.05) 1px, transparent 1px);
                background-size: 40px 40px;
                position: relative;
                }
                .whiteboard-bg::before {
                content: "";
                position: absolute;
                top: 0; left: 0; right: 0; bottom: 0;
                background: radial-gradient(circle at 10% 20%, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 40%);
                pointer-events: none;
                z-index: 1; /* 提升反光層級，蓋在塗鴉上但由 pointer-events: none 穿透 */
                }

                /* 塗改效果動畫 */
                @keyframes smudge {
                0% { opacity: 0; transform: scale(0.8) rotate(0deg); }
                20% { opacity: 0.8; transform: scale(1.1) rotate(-5deg); }
                40% { opacity: 0.9; transform: scale(1.1) rotate(5deg); }
                60% { opacity: 0.8; transform: scale(1.1) rotate(-3deg); }
                100% { opacity: 0; transform: scale(1) rotate(0deg); }
                }
                .animate-smudge {
                animation: smudge 0.6s ease-out forwards;
                }

                /* 升級版磁鐵樣式：#355d79 */
                .magnet {
                /* 基礎亮色 + 放射狀高光模擬塑膠光澤 */
                background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 50%), #355d79; 
                
                /* 複雜陰影 */
                box-shadow: 
                    0 4px 6px rgba(0,0,0,0.4), 
                    inset 0 -4px 6px rgba(0,0,0,0.3), 
                    inset 0 2px 4px rgba(255,255,255,0.3);
                    
                border: 1px solid rgba(255,255,255,0.2);
                transition: transform 0.1s, box-shadow 0.1s;
                cursor: grab;
                position: relative;
                }
                .magnet::after {
                content: '';
                position: absolute;
                top: 15%;
                left: 15%;
                width: 20%;
                height: 10%;
                background: rgba(255,255,255,0.4);
                border-radius: 50%;
                transform: rotate(-45deg);
                pointer-events: none;
                }
                
                .magnet:active {
                cursor: grabbing;
                transform: scale(0.95);
                box-shadow: 0 2px 3px rgba(0,0,0,0.3), inset 0 -2px 4px rgba(0,0,0,0.2);
                }

                /* 雜亂線圈 Hover 效果 */
                .scribble-hover {
                position: relative;
                }
                .scribble-hover::after {
                content: '';
                position: absolute;
                top: -10%; left: -10%; width: 120%; height: 120%;
                border: 2px solid transparent;
                border-radius: 50% 40% 60% 50% / 40% 50% 50% 60%;
                transition: all 0.3s ease;
                pointer-events: none;
                opacity: 0;
                }
                .scribble-hover:hover::after, .scribble-hover.active::after {
                border-color: currentColor;
                transform: rotate(-2deg);
                opacity: 0.6;
                }

                /* 隱藏 Scrollbar */
                .no-scrollbar::-webkit-scrollbar {
                display: none;
                }
                .no-scrollbar {
                -ms-overflow-style: none;
                scrollbar-width: none;
                }
                
                /* Modal 動畫 */
                @keyframes fadeIn {
                from { opacity: 0; transform: scale(0.95); }
                to { opacity: 1; transform: scale(1); }
                }
                .animate-fade-in {
                animation: fadeIn 0.2s ease-out forwards;
                }
            `}</style>
        );

        // 背景塗鴉組件：聖誕與棒球元素
        const BackgroundDoodles = () => (
        <div className="absolute inset-0 pointer-events-none overflow-hidden z-0">
            {/* 左上角：棒球 (淡灰色) -> 透明度調高至 0.1 */}
            <svg className="absolute top-10 -left-10 w-64 h-64 opacity-[0.1] transform -rotate-12 text-gray-600" viewBox="0 0 100 100">
            {/* 棒球輪廓 */}
            <circle cx="50" cy="50" r="40" fill="none" stroke="currentColor" strokeWidth="2" />
            {/* 縫線 */}
            <path d="M25 30 Q45 50 25 70" fill="none" stroke="currentColor" strokeWidth="2" strokeDasharray="3,3" />
            <path d="M75 30 Q55 50 75 70" fill="none" stroke="currentColor" strokeWidth="2" strokeDasharray="3,3" />
            </svg>

            {/* 右上角：聖誕樹塗鴉 (淡綠色) -> 透明度調高至 0.12 */}
            <svg className="absolute top-5 right-5 w-48 h-48 opacity-[0.12] text-green-800 transform rotate-6" viewBox="0 0 100 100">
            <path d="M50 10 L80 40 H60 L85 70 H55 L60 90 H40 L45 70 H15 L40 40 H20 Z" fill="none" stroke="currentColor" strokeWidth="2" strokeLinejoin="round"/>
            <circle cx="50" cy="10" r="3" fill="currentColor" opacity="0.5" />
            <circle cx="30" cy="50" r="2" fill="currentColor" opacity="0.3" />
            <circle cx="70" cy="60" r="2" fill="currentColor" opacity="0.3" />
            </svg>

            {/* 左下角：拐杖糖與棒球棒 (淡紅色/灰色) -> 透明度調高至 0.1 */}
            <svg className="absolute bottom-0 left-5 w-56 h-56 opacity-[0.1] transform -rotate-6" viewBox="0 0 100 100">
            {/* 拐杖糖 */}
            <path d="M30 90 V40 Q30 20 50 20 Q70 20 70 40" fill="none" stroke="#D32F2F" strokeWidth="4" strokeLinecap="round" />
            <path d="M30 50 H34 M30 60 H34 M30 70 H34" stroke="#D32F2F" strokeWidth="2" />
            {/* 棒球棒 */}
            <path d="M60 90 L80 30 Q82 20 86 20 Q90 20 92 30 L95 90 Q77 95 60 90 Z" fill="none" stroke="#374151" strokeWidth="2" />
            </svg>

            {/* 右下角：棒球與雪花 (混合) -> 透明度調高至 0.12 */}
            <svg className="absolute bottom-10 -right-5 w-40 h-40 opacity-[0.12] transform rotate-12" viewBox="0 0 100 100">
            {/* 棒球 */}
            <circle cx="50" cy="50" r="30" fill="none" stroke="#374151" strokeWidth="2" />
            <path d="M28 35 Q40 50 28 65" fill="none" stroke="#D32F2F" strokeWidth="1" strokeDasharray="2,2" />
            <path d="M72 35 Q60 50 72 65" fill="none" stroke="#D32F2F" strokeWidth="1" strokeDasharray="2,2" />
            {/* 雪花 */}
            <path d="M50 10 V20 M50 80 V90 M10 50 H20 M80 50 H90 M20 20 L30 30 M70 70 L80 80 M20 80 L30 70 M70 30 L80 20" stroke="#1E3A8A" strokeWidth="2" opacity="0.5" />
            </svg>

            {/* 散落的雪花點綴 -> 透明度調高至 0.25 */}
            <div className="absolute top-1/4 left-1/4 text-blue-200 opacity-25 text-4xl font-hand">*</div>
            <div className="absolute top-1/3 right-1/3 text-blue-200 opacity-25 text-5xl font-hand">❄</div>
            <div className="absolute bottom-1/3 left-10 text-red-200 opacity-25 text-3xl font-hand">⚾</div>
        </div>
        );

        // 聖誕帽組件
        const SantaHat = () => (
        <svg className="absolute -top-5 -left-2 w-10 h-10 transform -rotate-12 pointer-events-none" viewBox="0 0 50 50">
            <path d="M10 40 L25 10 L40 40 Q25 45 10 40 Z" fill="#D32F2F" />
            <circle cx="25" cy="8" r="4" fill="white" />
            <rect x="8" y="38" width="34" height="8" rx="4" fill="white" />
        </svg>
        );

        const App = () => {
            const initialTeams = [
                { id: 't1', name: '第一小隊', score: 0, color: '#B71C1C', history: [] }, // 深戰術紅
                { id: 't2', name: '第二小隊', score: 0, color: '#0D47A1', history: [] }, // 深策略藍
                { id: 't3', name: '第三小隊', score: 0, color: '#1B5E20', history: [] }, // 深活力綠
            ];

            const [teams, setTeams] = useState(initialTeams);
            const [selectedTeamId, setSelectedTeamId] = useState(null);
            const [draggedValue, setDraggedValue] = useState(null);
            const [resetTarget, setResetTarget] = useState(null);
            const [updatingTeamId, setUpdatingTeamId] = useState(null);

            const confirmReset = () => {
                if (resetTarget === 'all') {
                setTeams(initialTeams);
                setSelectedTeamId(null);
                } else if (resetTarget) {
                setTeams(prevTeams => prevTeams.map(t => 
                    t.id === resetTarget ? { ...t, score: 0, history: [] } : t
                ));
                }
                setUpdatingTeamId(null);
                setResetTarget(null);
            };

            const handleNameChange = (id, newName) => {
                setTeams(teams.map(t => t.id === id ? { ...t, name: newName } : t));
            };

            const addScore = (teamId, points) => {
                setUpdatingTeamId(teamId);
                setTimeout(() => setUpdatingTeamId(null), 600);
                setTeams(prevTeams => prevTeams.map(team => {
                if (team.id === teamId) {
                    return {
                    ...team,
                    score: team.score + points,
                    history: [...team.history, { val: points, id: Date.now() + Math.random() }]
                    };
                }
                return team;
                }));
            };

            const handleDragStart = (e, value) => {
                setDraggedValue(value);
                e.dataTransfer.effectAllowed = "copy";
            };
            const handleDragOver = (e) => e.preventDefault();
            const handleDrop = (e, teamId) => {
                e.preventDefault();
                if (draggedValue) {
                addScore(teamId, draggedValue);
                setDraggedValue(null);
                }
            };
            const handleTeamClick = (teamId) => {
                setSelectedTeamId(teamId === selectedTeamId ? null : teamId);
            };
            const handleMagnetClick = (value) => {
                if (selectedTeamId) {
                addScore(selectedTeamId, value);
                } else {
                const header = document.getElementById('instruction-text');
                if(header) {
                    header.classList.add('animate-bounce');
                    setTimeout(() => header.classList.remove('animate-bounce'), 1000);
                }
                }
            };

            const getModalContent = () => {
                if (resetTarget === 'all') {
                return { title: "全部清除？", desc: "這將會擦掉「所有小隊」的分數紀錄，無法復原喔！" };
                } else {
                const targetTeam = teams.find(t => t.id === resetTarget);
                return { title: `清除 ${targetTeam?.name || '此小隊'}？`, desc: "這將會歸零該小隊的分數與紀錄，確定要擦掉嗎？" };
                }
            };

            return (
                <div className="min-h-screen w-full whiteboard-bg font-sans text-gray-800 flex flex-col overflow-hidden select-none relative">
                <FontStyles />
                <BackgroundDoodles />

                {/* Modal */}
                {resetTarget && (
                    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-4">
                    <div className="bg-white rounded-xl shadow-2xl p-6 max-w-sm w-full animate-fade-in border-4 border-gray-200 transform rotate-1">
                        <h3 className="text-2xl font-bold text-gray-800 mb-2 font-tw-bold">{getModalContent().title}</h3>
                        <p className="text-gray-600 mb-6 font-hand text-xl">{getModalContent().desc}</p>
                        <div className="flex gap-4 justify-end">
                        <button onClick={() => setResetTarget(null)} className="px-4 py-2 rounded-lg border-2 border-gray-300 text-gray-600 hover:bg-gray-100 font-bold flex items-center gap-2 transition-colors">
                            <X size={20} /> 取消
                        </button>
                        <button onClick={confirmReset} className="px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 shadow-md font-bold flex items-center gap-2 transition-transform active:scale-95">
                            <Eraser size={20} /> 擦乾淨
                        </button>
                        </div>
                    </div>
                    </div>
                )}

                {/* Header */}
                <header className="relative z-10 flex justify-between items-center p-4 md:p-6 border-b-2 border-gray-300/50">
                    <div className="relative transform -rotate-1">
                    <h1 className="text-4xl md:text-6xl font-marker text-gray-800 tracking-wider relative z-10 px-4 py-1">
                        <span className="relative inline-block">
                        S
                        <SantaHat />
                        </span>
                        coring Board
                        <svg className="absolute top-0 left-0 w-full h-full -z-10 pointer-events-none overflow-visible" viewBox="0 0 300 60">
                        <path d="M10,20 Q150,-10 290,25 Q280,65 150,55 Q20,60 10,20" fill="none" stroke="#D32F2F" strokeWidth="3" strokeLinecap="round" strokeDasharray="600" style={{strokeDashoffset: 0}} />
                        </svg>
                    </h1>
                    <p className="text-gray-600 text-lg md:text-xl ml-4 mt-2 font-hand font-bold tracking-wide">今日戰況 / Today's Battle</p>
                    </div>
                    <button onClick={() => setResetTarget('all')} className="group flex flex-col items-center gap-1 transition-transform hover:rotate-6 active:scale-95" title="全部清除">
                    <div className="bg-[#355d79] text-white p-3 rounded shadow-lg border-b-4 border-[#254155] flex items-center justify-center w-16 h-10 relative overflow-hidden">
                        <div className="absolute inset-0 bg-white/10 skew-x-12 -ml-4"></div>
                        <Eraser size={20} />
                    </div>
                    <span className="text-xs font-bold text-gray-500 font-tw-bold">全部清除</span>
                    </button>
                </header>

                {/* Main Board */}
                <main className="flex-1 flex flex-col md:flex-row relative z-10 p-2 md:p-4 gap-2 md:gap-0">
                    {teams.map((team, index) => (
                    <div 
                        key={team.id}
                        onDragOver={handleDragOver}
                        onDrop={(e) => handleDrop(e, team.id)}
                        onClick={() => handleTeamClick(team.id)}
                        className={`
                        flex-1 flex flex-col items-center relative transition-all duration-300
                        ${index !== teams.length - 1 ? 'md:border-r-2 md:border-gray-800/20 md:border-dashed' : ''}
                        ${selectedTeamId === team.id ? 'bg-yellow-50/50 ring-4 ring-yellow-400/30 rounded-lg' : ''}
                        hover:bg-gray-50/30 group/team
                        `}
                        style={{ minHeight: '300px' }}
                    >
                        {selectedTeamId === team.id && (
                            <div className="absolute inset-2 border-4 border-blue-400/20 rounded-xl pointer-events-none" style={{ borderRadius: '20px 30px 15px 25px / 30px 15px 40px 20px' }}></div>
                        )}

                        <div className="mt-6 w-3/4 flex items-end justify-center relative">
                        <div className="relative w-full text-center">
                            <input
                            type="text"
                            value={team.name}
                            onChange={(e) => handleNameChange(team.id, e.target.value)}
                            className="w-full text-center text-2xl md:text-4xl font-tw-serif-bold bg-transparent border-b-2 border-gray-800 focus:border-blue-500 outline-none pb-2 text-gray-700 transition-colors"
                            style={{ borderColor: selectedTeamId === team.id ? team.color : 'rgba(0,0,0,0.6)' }}
                            />
                            <span className="absolute -bottom-6 right-0 text-sm text-gray-400 opacity-0 group-hover/team:opacity-100 transition-opacity font-hand">點擊修改</span>
                        </div>
                        <button
                            onClick={(e) => {
                            e.stopPropagation();
                            setResetTarget(team.id);
                            }}
                            className="absolute -right-8 top-2 text-gray-300 hover:text-red-500 hover:bg-red-50 p-1.5 rounded-full transition-all opacity-0 group-hover/team:opacity-100"
                            title={`清除 ${team.name} 分數`}
                        >
                            <Eraser size={18} />
                        </button>
                        </div>

                        <div className="mt-8 mb-4 relative w-full h-32 flex items-center justify-center">
                        {updatingTeamId === team.id && (
                            <div className="absolute inset-0 flex items-center justify-center z-20 animate-smudge pointer-events-none">
                            <div className="w-32 h-24 bg-gray-200/80 blur-md rounded-full transform rotate-12"></div>
                            </div>
                        )}
                        <div className="text-8xl md:text-9xl font-marker transition-all duration-300 drop-shadow-sm" style={{ color: team.color }}>
                            {team.score}
                        </div>
                        </div>

                        <div className="flex-1 w-full px-4 mt-4 relative">
                            <div className="text-center text-gray-400 text-lg mb-2 font-hand font-bold opacity-80">得分歷程 / History</div>
                            <div className="flex flex-wrap justify-center gap-2 content-start min-h-[120px] p-4 bg-white/30 rounded-xl border-2 border-gray-200/50 border-dashed">
                            {/* 已移除 "拖曳磁鐵至此" 文字 */}
                            {team.history.map((record) => (
                                <div 
                                key={record.id}
                                className="w-8 h-8 rounded-full flex items-center justify-center font-bold text-white text-sm shadow-sm transform hover:scale-110 transition-transform cursor-default font-sans"
                                style={{ backgroundColor: team.color }}
                                title={`+${record.val}`}
                                >
                                {record.val}
                                </div>
                            ))}
                            </div>
                        </div>
                    </div>
                    ))}
                </main>

                {/* Footer Controls */}
                <footer className="relative z-20 bg-gray-100/90 border-t-4 border-gray-300 p-4 md:p-6 shadow-2xl">
                    <div className="max-w-5xl mx-auto">
                    {/* 縮小並淡化的操作說明 */}
                    <div id="instruction-text" className="text-center mb-4 text-gray-400 text-xs md:text-sm font-hand flex flex-wrap items-center justify-center gap-2 opacity-80">
                        <span>操作提示：拖曳磁鐵 (Drag)</span>
                        <span>或</span>
                        <span>點選組別 + 按數字 (Click)</span>
                    </div>
                    
                    <div className="flex flex-wrap justify-center gap-3 md:gap-6">
                        {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map((num) => (
                        <div
                            key={num}
                            draggable
                            onDragStart={(e) => handleDragStart(e, num)}
                            onClick={() => handleMagnetClick(num)}
                            className={`
                            magnet w-12 h-12 md:w-16 md:h-16 rounded-full 
                            flex items-center justify-center 
                            text-2xl md:text-3xl font-marker text-white
                            scribble-hover
                            transition-transform active:scale-90
                            `}
                            style={{ paddingTop: '4px' }}
                        >
                            {num}
                        </div>
                        ))}
                    </div>
                    </div>
                </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


